(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{215:function(a,e,t){"use strict";t.r(e);var s=t(0),r=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"安全漏洞与问题处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全漏洞与问题处理","aria-hidden":"true"}},[a._v("#")]),a._v(" 安全漏洞与问题处理")]),a._v(" "),t("p",[a._v("Webview为业务发展提供了强大的动态化和引流能力， 同时也为业务开发提供了跟多灵活的选择。 但在其使用过程中也有很多安全漏洞和问题被暴露出来，例如任意代码执行，跨域问题等等。")]),a._v(" "),t("p",[a._v("同时，伴随着Webview与内核的发展与迭代，高版本中修复的的Bug和漏洞，仍需要我们在低版本中进行兼容和处理。")]),a._v(" "),t("h2",{attrs:{id:"javascriptinterface-注入对象漏洞"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javascriptinterface-注入对象漏洞","aria-hidden":"true"}},[a._v("#")]),a._v(" JavascriptInterface 注入对象漏洞")]),a._v(" "),t("ul",[t("li",[a._v("在"),t("router-link",{attrs:{to:"/tech/webview/interface-js2java.html"}},[a._v("Web端调用客户端方法")]),a._v(" 中所提到的， Webview 注册"),t("code",[a._v("JavascriptInterface")]),a._v("对象，可以实现Web端对于客户端方法的调用。\n在Android 4.2以下版本中，通过Java的反射机制，攻击者可以获取到系统类对象为所欲为。")],1)]),a._v(" "),t("p",[a._v("在Android 4.2 以上版本中， 为了解决该问题， Webview规定只有被"),t("code",[a._v("@JavascriptInterface")]),a._v("注解过的方法才能被Web端调用到。")]),a._v(" "),t("p",[a._v("如果不在4.2以下系统中注册"),t("code",[a._v("JavascriptInterface")]),a._v("对象， 是否就可以规避该漏洞带来的风险呢？ 答案是NO.")]),a._v(" "),t("p",[a._v("即便我们不主动向Webview中注册"),t("code",[a._v("JavascriptInterface")]),a._v("对象， 但由于Webview自身默认注册的对象也会被攻击者利用，因此我们需要移除掉相关"),t("code",[a._v("JavascriptInterface")]),a._v("对象：")]),a._v(" "),t("div",{staticClass:"language-Java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("removeJavascriptInterface")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"searchBoxJavaBridge_"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("removeJavascriptInterface")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"accessibility"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("removeJavascriptInterface")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"accessibilityTraversal"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h2",{attrs:{id:"file协议的安全性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#file协议的安全性","aria-hidden":"true"}},[a._v("#")]),a._v(" file协议的安全性")]),a._v(" "),t("p",[a._v("在实际应用过程中，我们通常需要Webview能够访问或加载本地文件的功能， 这就需要WebSettings允许开启文件访问功能"),t("code",[a._v("setAllowFileAccess(true)")]),a._v("。")]),a._v(" "),t("p",[a._v("功能增强的同时，也带来了一定的安全风险， 需要进行一系列的拦截和处理措施。")]),a._v(" "),t("p",[a._v("除了"),t("code",[a._v("setAllowFileAccess")]),a._v("， "),t("code",[a._v("WebSettings")]),a._v("中还有两个设置：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("setAllowFileAccessFromFileURLs (boolean flag)\n设置是否允许以 "),t("code",[a._v("file://")]),a._v(" URL的方式加载的Javascript访问本地其他文件内容。")])]),a._v(" "),t("li",[t("p",[a._v("setAllowUniversalAccessFromFileURLs (boolean flag)\n设置是否允许以 "),t("code",[a._v("file://")]),a._v(" URL的方式加载的Javascript访问其他源的数据。")])])]),a._v(" "),t("p",[a._v("当这两种配置开启的时候， Webview加载的本地Javascript可以访问本地文件和其他域的内容。\n为了避免被恶意攻击， 建议每次加载url之前， 对相应的URL进行校验。 如果是可信任的URL， 则启用设置。")]),a._v(" "),t("p",[a._v("除此之外，在加载URL之前， 建议对URL进行校验， 不去加载有安全隐患的URL。")])])}),[],!1,null,null,null);e.default=r.exports}}]);