(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{216:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"web端调用客户端方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#web端调用客户端方法","aria-hidden":"true"}},[t._v("#")]),t._v(" Web端调用客户端方法")]),t._v(" "),s("p",[t._v("通常情况下， Web端都是作为业务方存在，通过webview作为桥梁与客户端进行交互。\n在Web端调用Native接口的方法主要有以下三种途径：")]),t._v(" "),s("ul",[s("li",[t._v("注册"),s("code",[t._v("JavascriptInterface")]),t._v("对象")]),t._v(" "),s("li",[t._v("通过alert，confirm，以及prompt方法传值到Native层")]),t._v(" "),s("li",[t._v("Native拦截url请求获取到JS所传递的数据")])]),t._v(" "),s("h2",{attrs:{id:"方法一-：注册javascriptinterface对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法一-：注册javascriptinterface对象","aria-hidden":"true"}},[t._v("#")]),t._v(" 方法一 ：注册"),s("code",[t._v("JavascriptInterface")]),t._v("对象")]),t._v(" "),s("h3",{attrs:{id:"native端："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#native端：","aria-hidden":"true"}},[t._v("#")]),t._v(" Native端：")]),t._v(" "),s("ul",[s("li",[t._v("Step1. 实现可供调用的JavascriptInterface")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GiraffeJSInterface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@JavascriptInterface")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("showToast")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("ul",[s("li",[t._v("Step2. 开启JS功能并注册JavascriptInterface")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("webSetting"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setJavaScriptEnabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmWebview"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addJavascriptInterface")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GiraffeJSInterface")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Giraffe"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("Step3. 加载H5页面")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("mWebview"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mUrl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"web端："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#web端：","aria-hidden":"true"}},[t._v("#")]),t._v(" Web端：")]),t._v(" "),s("ul",[s("li",[s("ol",[s("li",[t._v("调用对应方法：")])])])]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("language")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("javascript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I\' a msg from js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onclick")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("Giraffe.showToast(msg)"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Show Toast"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("局限性")]),t._v(" "),s("ol",[s("li",[t._v("在4.2之前的系统上存在安全问题：被注册的JavascriptInterface对象所有公共方法都可以被访问到；")]),t._v(" "),s("li",[t._v("在4.2以后，只有通过"),s("code",[t._v("@JavascriptInterface")]),t._v("注解的公共方法才能被调用。")])])]),t._v(" "),s("h4",{attrs:{id:"方法二-：拦截prompt方法传值到native层"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法二-：拦截prompt方法传值到native层","aria-hidden":"true"}},[t._v("#")]),t._v(" 方法二 ：拦截prompt方法传值到Native层")]),t._v(" "),s("p",[t._v("当Web端调用alert，confirm，以及prompt方法的弹框时，客户端可以在对应的回调方法中拦截到相应的调用信息，从而获取到传递相应数据到Native并唤起相应的功能和服务。")]),t._v(" "),s("p",[t._v("通常情况下，考虑到返回值的灵活性，客户端通常选择覆写"),s("code",[t._v("WebChromeClient")]),t._v("中的"),s("code",[t._v("onJsPrompt")]),t._v("回调方法，对prompt方法调用拦截，并根据相应的"),s("code",[t._v("JSBridge")]),t._v("协议进行处理。")]),t._v(" "),s("p",[t._v("然而有些问题需要我们注意下， 通常情况下我们认为onJSprompt方法中不会对参数长度进行限制，但在实际业务开发中业务方传递了什么却无法控制。 见过一些异常的Case， 某些机型和系统对传递过来的超长url进行了截断， 出现非常诡异的Bug， 因此不建议业务方夹杂过多无用参数在url中。")]),t._v(" "),s("h4",{attrs:{id:"方法三-：通过拦截url请求获取到js所传递的数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法三-：通过拦截url请求获取到js所传递的数据","aria-hidden":"true"}},[t._v("#")]),t._v(" 方法三 ：通过拦截url请求获取到JS所传递的数据")]),t._v(" "),s("p",[t._v("当Web端通过"),s("code",[t._v("<a href=“xxxx”>")]),t._v("标签进行页面跳转请求的时候，通常情况下都会回调给客户端， Android可以在"),s("code",[t._v("WebViewClient")]),t._v("的"),s("code",[t._v("shouldOverrideUrlLoading")]),t._v("方法中拿到相应的链接回调。")]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("shouldOverrideUrlLoading")]),t._v("方法中，除了可以像"),s("code",[t._v("方法二")]),t._v("中识别出的"),s("code",[t._v("JSBridge")]),t._v("协议进行处理， 在执行"),s("code",[t._v("loadUrl")]),t._v("操作之前，建议对相应的链接进行安全校验和检查。")]),t._v(" "),s("p",[t._v("另外， 实践过程中业务方在Web端的链接调用方式千奇百怪，有几种调用问题需要注意一下：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v('iframe + target="_blank"')]),t._v("的调用方式无法回调到"),s("code",[t._v("shouldOverrideUrlLoading")]),t._v("方法。")]),t._v(" "),s("li",[t._v("当客户端支持了多窗口模式"),s("code",[t._v("setSupportMultipleWindows")]),t._v("后, 对于"),s("code",[t._v('target="_blank"')]),t._v("的情况，如果链接是一个"),s("code",[t._v("非网络url")]),t._v("， "),s("code",[t._v("shouldOverrideUrlLoading")]),t._v("方法有可能不会被回调到。 如果需要，可以在"),s("code",[t._v("onCreateWindow")]),t._v("方法里面拦截处理。")])]),t._v(" "),s("p",[t._v("个人觉得"),s("code",[t._v('target="_blank')]),t._v("这种情况对于客户端是个伪需求， 因为移动端的页面栈是自己来管理的，通常并不会新开一个页面来加载Web页面，而是在当前页面处理； 而对于PC端而言，"),s("code",[t._v("JSBridge")]),t._v("协议本身又不会生效。\n因此对于此种case，统一收口在"),s("code",[t._v("shouldOverrideUrlLoading")]),t._v("方法里面处理即可。")])])}),[],!1,null,null,null);a.default=e.exports}}]);