<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Weex-toolkit build with VueRouter | Giraffe&#39;s Blog</title>
    <meta name="description" content=" ">
    <link rel="icon short" href="/ico_avatar.ico" type="image/x-icon">
    
    <link rel="preload" href="/assets/css/0.styles.2fd78da2.css" as="style"><link rel="preload" href="/assets/js/app.36f7a4d5.js" as="script"><link rel="preload" href="/assets/js/3.5e56f3a6.js" as="script"><link rel="preload" href="/assets/js/2.a56e4763.js" as="script"><link rel="preload" href="/assets/js/43.d6325d70.js" as="script"><link rel="prefetch" href="/assets/js/10.d856c855.js"><link rel="prefetch" href="/assets/js/11.171a332b.js"><link rel="prefetch" href="/assets/js/12.34e00da0.js"><link rel="prefetch" href="/assets/js/13.6a4bbdce.js"><link rel="prefetch" href="/assets/js/14.4eef22e3.js"><link rel="prefetch" href="/assets/js/15.80d8c8f1.js"><link rel="prefetch" href="/assets/js/16.408ca987.js"><link rel="prefetch" href="/assets/js/17.267749f1.js"><link rel="prefetch" href="/assets/js/18.be1ceda1.js"><link rel="prefetch" href="/assets/js/19.d6d6110b.js"><link rel="prefetch" href="/assets/js/20.c63fb21f.js"><link rel="prefetch" href="/assets/js/21.a8cdd90b.js"><link rel="prefetch" href="/assets/js/22.e6989c2d.js"><link rel="prefetch" href="/assets/js/23.6efb0d64.js"><link rel="prefetch" href="/assets/js/24.225dff0d.js"><link rel="prefetch" href="/assets/js/25.d6301564.js"><link rel="prefetch" href="/assets/js/26.48130fde.js"><link rel="prefetch" href="/assets/js/27.b4f579f9.js"><link rel="prefetch" href="/assets/js/28.d4af6c44.js"><link rel="prefetch" href="/assets/js/29.4dbe3fbe.js"><link rel="prefetch" href="/assets/js/30.d9c89cfb.js"><link rel="prefetch" href="/assets/js/31.314c8ce0.js"><link rel="prefetch" href="/assets/js/32.9ec8b6ed.js"><link rel="prefetch" href="/assets/js/33.668a40d2.js"><link rel="prefetch" href="/assets/js/34.746f8d03.js"><link rel="prefetch" href="/assets/js/35.84de9a82.js"><link rel="prefetch" href="/assets/js/36.a243395d.js"><link rel="prefetch" href="/assets/js/37.a9ff6e8c.js"><link rel="prefetch" href="/assets/js/38.1c3e1cdf.js"><link rel="prefetch" href="/assets/js/39.718c02a7.js"><link rel="prefetch" href="/assets/js/4.21f7bc64.js"><link rel="prefetch" href="/assets/js/40.640dda28.js"><link rel="prefetch" href="/assets/js/41.b05559b1.js"><link rel="prefetch" href="/assets/js/42.32bc5efc.js"><link rel="prefetch" href="/assets/js/44.4897fa11.js"><link rel="prefetch" href="/assets/js/45.cc5207d2.js"><link rel="prefetch" href="/assets/js/46.ccff6404.js"><link rel="prefetch" href="/assets/js/5.e8e54c08.js"><link rel="prefetch" href="/assets/js/6.567c728a.js"><link rel="prefetch" href="/assets/js/7.efc9b48d.js"><link rel="prefetch" href="/assets/js/8.2d41cbc0.js"><link rel="prefetch" href="/assets/js/9.d52aa902.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fd78da2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Giraffe's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/reading/" class="nav-link">阅读随笔</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">技术思考</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/reading/" class="nav-link">阅读随笔</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">技术思考</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="weex-toolkit-build-with-vuerouter"><a href="#weex-toolkit-build-with-vuerouter" aria-hidden="true" class="header-anchor">#</a> Weex-toolkit build with VueRouter</h1> <p>As same as a Vue project, we also need an entry file to build the web pages for the weex project. If we want to use the VueRouter in our project, we also need to create a router config file.</p> <h2 id="web-building-with-vuerouter"><a href="#web-building-with-vuerouter" aria-hidden="true" class="header-anchor">#</a> Web Building with VueRouter</h2> <h3 id="common-configs-for-web"><a href="#common-configs-for-web" aria-hidden="true" class="header-anchor">#</a> common configs for web</h3> <p>In <code>webpack.common.conf.js</code>, Weex-toolkit creates an entry file in <code>.temp/</code> directory for web pages, as well as the router config file.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// .temp/entry.js</span>
<span class="token keyword">const</span> entryFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>vueWebTemp<span class="token punctuation">,</span> config<span class="token punctuation">.</span>entryFilePath<span class="token punctuation">)</span>
<span class="token comment">// .temp/router.js</span>
<span class="token keyword">const</span> routerFile <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>vueWebTemp<span class="token punctuation">,</span> config<span class="token punctuation">.</span>routerFilePath<span class="token punctuation">)</span>
<span class="token comment">// generate .temp/entry.js base on src/entry.js</span>
fs<span class="token punctuation">.</span><span class="token function">outputFileSync</span><span class="token punctuation">(</span>entryFile<span class="token punctuation">,</span> <span class="token function">getEntryFileContent</span><span class="token punctuation">(</span>helper<span class="token punctuation">.</span><span class="token function">root</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>entryFilePath<span class="token punctuation">)</span><span class="token punctuation">,</span> routerFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// generate router.js</span>
fs<span class="token punctuation">.</span><span class="token function">outputFileSync</span><span class="token punctuation">(</span>routerFile<span class="token punctuation">,</span> <span class="token function">getRouterFileContent</span><span class="token punctuation">(</span>helper<span class="token punctuation">.</span><span class="token function">root</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>routerFilePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The function <code>getEntryFileContent</code> generates <code>entry.js</code> for the web building:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getEntryFileContent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> routerpath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">// import the vue and weex-vue-render for entry.js</span>
  <span class="token keyword">let</span> dependence <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import Vue from 'vue'\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  dependence <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import weex from 'weex-vue-render'\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token comment">// the plugins are defined in 'plugins/plugins.js'</span>
  <span class="token keyword">let</span> relativePluginPath <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">rootNode</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>pluginFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// read the content of entry.js, if developers define it.</span>
  <span class="token keyword">let</span> entryContents <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> contents <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  entryContents <span class="token operator">=</span> dependence <span class="token operator">+</span> entryContents<span class="token punctuation">;</span>
  <span class="token comment">// init weex before the mark 'weex initialized'</span>
  entryContents <span class="token operator">=</span> entryContents<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\/\* weex initialized/</span><span class="token punctuation">,</span> <span class="token parameter">match</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">weex.init(Vue)\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isWin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    relativePluginPath <span class="token operator">=</span> relativePluginPath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\/g</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// if plugins are defined in the plugins.js</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasPluginInstalled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    contents <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n// If detact plugins/plugin.js is exist, import and the plugin.js\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    contents <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import plugins from '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relativePluginPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">';\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    contents <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">plugins.forEach(function (plugin) {\n\tweex.install(plugin)\n});\n\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    entryContents <span class="token operator">=</span> entryContents<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\.\/router/</span><span class="token punctuation">,</span> routerpath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    entryContents <span class="token operator">=</span> entryContents<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/weex\.init/</span><span class="token punctuation">,</span> <span class="token parameter">match</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contents<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> entryContents<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>webConfig</code> is the config object for compile jsbundle for web:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// the entry config</span>
entry<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>webEntry<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">'vendor'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/phantom-limb/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">//  the compiled jsbundle is in `./dist`</span>
output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> helper<span class="token punctuation">.</span><span class="token function">rootNode</span><span class="token punctuation">(</span><span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  filename<span class="token punctuation">:</span> <span class="token string">'[name].web.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// the resolve options change how modules are resolved</span>
resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token comment">// Automatically resolve certain extensions. </span>
  extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'@'</span><span class="token punctuation">:</span> helper<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="release-configs-with-vuerouter"><a href="#release-configs-with-vuerouter" aria-hidden="true" class="header-anchor">#</a> release configs with VueRouter</h3> <p>The file <code>webpack.release.conf.js</code> is the webpack configuration for the release version of web bundle. It merges the common configuration mentioned above.</p> <p>Compared with common configs, the release config file and adds some additional plugins to the compiler:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// create global ENV constant which can be used in compile time to compress the js files</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">'process.env'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'NODE_ENV'</span><span class="token punctuation">:</span> config<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>env
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// Javascript won't be executed until the html file is parsed</span>
    <span class="token keyword">new</span> <span class="token class-name">ScriptExtHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      defaultAttribute<span class="token punctuation">:</span> <span class="token string">'defer'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyJsparallelPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      workers<span class="token punctuation">:</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">,</span>
      mangle<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      compressor<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        warnings<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        drop_console<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        drop_debugger<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// Simplifies creation of HTML files to serve your webpack bundles</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span> <span class="token string">'web/index.html'</span><span class="token punctuation">,</span>
      chunksSortMode<span class="token punctuation">:</span> <span class="token string">'dependency'</span><span class="token punctuation">,</span><span class="token comment">// changes how chunks are sorted </span>
      inject<span class="token punctuation">:</span> <span class="token string">'head'</span> <span class="token comment">// inject the js link to html header</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// create html file for entrys</span>
    <span class="token operator">...</span><span class="token function">generateMultipleEntrys</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><p>The outputs of the command <code>npm run build:prod:web</code> in the dir <code>release/web</code>;</p> <h2 id="weex-building-with-vuerouter"><a href="#weex-building-with-vuerouter" aria-hidden="true" class="header-anchor">#</a> weex building with VueRouter</h2> <p>With VueRouter, the compile configures for Weex is much simpler. In <code>webpack.common.conf.js</code>, single entry file and output file is defined:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> weexEntry <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'index'</span><span class="token punctuation">:</span> helper<span class="token punctuation">.</span><span class="token function">root</span><span class="token punctuation">(</span><span class="token string">'entry.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

entry<span class="token punctuation">:</span> weexEntry<span class="token punctuation">,</span>
output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>The <code>webpack.prod.conf.js</code> file only adds a &quot;uglify&quot; plugin for production env.</p> <p><img src="/weex/weex-build-router.jpg" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div> <div class="wrapper" data-v-5a084129><h5 data-v-5a084129></h5> <img src="/qrcode_self.jpg" data-v-5a084129></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.36f7a4d5.js" defer></script><script src="/assets/js/3.5e56f3a6.js" defer></script><script src="/assets/js/2.a56e4763.js" defer></script><script src="/assets/js/43.d6325d70.js" defer></script>
  </body>
</html>
