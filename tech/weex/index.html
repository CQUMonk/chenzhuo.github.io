<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Overview | Giraffe&#39;s Blog</title>
    <meta name="description" content=" ">
    <link rel="icon short" href="/ico_avatar.ico" type="image/x-icon">
    
    <link rel="preload" href="/assets/css/0.styles.2fd78da2.css" as="style"><link rel="preload" href="/assets/js/app.36f7a4d5.js" as="script"><link rel="preload" href="/assets/js/3.5e56f3a6.js" as="script"><link rel="preload" href="/assets/js/2.a56e4763.js" as="script"><link rel="preload" href="/assets/js/41.b05559b1.js" as="script"><link rel="prefetch" href="/assets/js/10.d856c855.js"><link rel="prefetch" href="/assets/js/11.171a332b.js"><link rel="prefetch" href="/assets/js/12.34e00da0.js"><link rel="prefetch" href="/assets/js/13.6a4bbdce.js"><link rel="prefetch" href="/assets/js/14.4eef22e3.js"><link rel="prefetch" href="/assets/js/15.80d8c8f1.js"><link rel="prefetch" href="/assets/js/16.408ca987.js"><link rel="prefetch" href="/assets/js/17.267749f1.js"><link rel="prefetch" href="/assets/js/18.be1ceda1.js"><link rel="prefetch" href="/assets/js/19.d6d6110b.js"><link rel="prefetch" href="/assets/js/20.c63fb21f.js"><link rel="prefetch" href="/assets/js/21.a8cdd90b.js"><link rel="prefetch" href="/assets/js/22.e6989c2d.js"><link rel="prefetch" href="/assets/js/23.6efb0d64.js"><link rel="prefetch" href="/assets/js/24.225dff0d.js"><link rel="prefetch" href="/assets/js/25.d6301564.js"><link rel="prefetch" href="/assets/js/26.48130fde.js"><link rel="prefetch" href="/assets/js/27.b4f579f9.js"><link rel="prefetch" href="/assets/js/28.d4af6c44.js"><link rel="prefetch" href="/assets/js/29.4dbe3fbe.js"><link rel="prefetch" href="/assets/js/30.d9c89cfb.js"><link rel="prefetch" href="/assets/js/31.314c8ce0.js"><link rel="prefetch" href="/assets/js/32.9ec8b6ed.js"><link rel="prefetch" href="/assets/js/33.668a40d2.js"><link rel="prefetch" href="/assets/js/34.746f8d03.js"><link rel="prefetch" href="/assets/js/35.84de9a82.js"><link rel="prefetch" href="/assets/js/36.a243395d.js"><link rel="prefetch" href="/assets/js/37.a9ff6e8c.js"><link rel="prefetch" href="/assets/js/38.1c3e1cdf.js"><link rel="prefetch" href="/assets/js/39.718c02a7.js"><link rel="prefetch" href="/assets/js/4.21f7bc64.js"><link rel="prefetch" href="/assets/js/40.640dda28.js"><link rel="prefetch" href="/assets/js/42.32bc5efc.js"><link rel="prefetch" href="/assets/js/43.d6325d70.js"><link rel="prefetch" href="/assets/js/44.4897fa11.js"><link rel="prefetch" href="/assets/js/45.cc5207d2.js"><link rel="prefetch" href="/assets/js/46.ccff6404.js"><link rel="prefetch" href="/assets/js/5.e8e54c08.js"><link rel="prefetch" href="/assets/js/6.567c728a.js"><link rel="prefetch" href="/assets/js/7.efc9b48d.js"><link rel="prefetch" href="/assets/js/8.2d41cbc0.js"><link rel="prefetch" href="/assets/js/9.d52aa902.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fd78da2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Giraffe's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/reading/" class="nav-link">阅读随笔</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">技术思考</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/reading/" class="nav-link">阅读随笔</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">技术思考</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="overview"><a href="#overview" aria-hidden="true" class="header-anchor">#</a> Overview</h1> <p>2018年初，我开始接手店长社区相关工作，负责进行整条业务线的业务支撑与研发工作， 除了面对新团队磨合与异地沟通等相关问题， 强运营性质的产品需求接踵而至。
在项目推进过程中我们发现， 团队同学们经常会因为一些紧急需求手忙脚乱， 开发资源时而捉襟见肘。</p> <p>除了进行项目管理的建设工作之外， 我们也在技术层面寻求移动端动态化和跨平台开发的解决方案， 从而保证提升开发人效的同时能够快速响应业务需求。</p> <p>基于上述业务需求的背景， 我和动态化项目组的小伙伴们选择了<code>Weex</code>作为公司业务动态化方案的框架基础，并围绕它的SDK进行基础设施的建设工作。</p> <p>本文对团队在完成<code>Weex</code>基础建设工作进行了简单梳理和概述，具体问题和解决方案将逐步补充和索引。</p> <h2 id="introduction"><a href="#introduction" aria-hidden="true" class="header-anchor">#</a> Introduction</h2> <p><code>Weex</code> 是Alibaba开源的一款基于web技术的移动端应用开发的框架，具有跨平台，动态化，和高性能的特点，能够帮助开发人员使用同一套代码来构建 Android、iOS 和 Web 应用，关于weexSDK的更多介绍和动态请移步<a href="http://weex.apache.org/" target="_blank" rel="noopener noreferrer">Weex官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>提到<code>Weex</code>，熟悉移动端跨平台技术的同学肯定会想到<code>Facebook</code>出品的 <code>React Native</code>。
相比而言 <code>Weex</code> 比RN更适合页面粒度的混合开发，同时也需要公司团队进行大量的基础设施建设的完善和补充； 而RN更适合小型公司去完成App粒度的开发与业务试错。</p> <p>事实上，团队一直保持着对移动端动态化跨平台技术保持着探索，无论是早年的<code>Hybrid</code>技术，以及Facebook的<code>React Native</code>，
甚至在微信小程序问世之初，我们也在自己APP中研发过自己的小程序框架<a href="https://github.com/weidian-inc/hera" target="_blank" rel="noopener noreferrer">Hera<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>基于先前开发工作的沉淀与公司现有技术栈的考虑，我们还是选择了Weex来进行现有业务的开发，从而帮助我们能够更加快速地响应产品和运营的需求，达到提高开发人效的同时又保证产品性能和交互体验的目的。</p> <p>在调研和实践过程中我们发现， 尽管<code>Weex</code>官方提供了开发友好的工程脚手架和应用示例，但仍然远远无法满足我们在业务开发过程中的种种需求。
因为当我们站在产品业务侧考虑问题时，一方面要灵活应变的各类业务场景，另一方面更要保证业务本身的稳定，安全和高可用。</p> <p>与此同时，为了便于技术方案的推广和落地，达到提升人效的目的，还需要尽可能地考虑提升开发者友好度，实现与现有业务和公司平台的无缝对接。</p> <p>为此，我们围绕官方提供的SDK进行了一系列深度优化和建设，打造了适用于公司业务开发的Weex生态系统，不仅涵盖了Weex项目的快速搭建，开发，测试，部署的方方面面，同时也和公司现有系统和策略完成了对接和打通，为整个业务开发和发布流程提供了一站式的解决方案。</p> <p><img src="/weex/weex-arch.png" alt=""></p> <p>如上图所示，初期的基础设施建设工作主要包括以下三个部分。</p> <h2 id="i-宿主容器建设"><a href="#i-宿主容器建设" aria-hidden="true" class="header-anchor">#</a> I. 宿主容器建设</h2> <p>围绕着Weex SDK， 我们在宿主App打造了用于承载Weex页面运行的容器。
在客户端与Weex混合开发过程中， 宿主容器在负责页面栈以及路由跳转管理的同时， 还封装了常用的API接口和UI组件。</p> <p>通过对App底层的网络，日志等模块的封装和扩展， Module向Weex提供了App原生的能力和必要的业务数据信息。</p> <p>站在工程人效的角度来看，移动端的跨平台的开发框架提供了代码多端运行的能力，从而降低了业务开发和维护的成本。
为了进一步提升人效，还需要我们为不同的业务方（不同BU）提供通用的业务组件或者API。</p> <p>从图中可以看到， 为了保证业务在跨平台方面具有良好的可用性，无论是封装了底层API的<code>Module</code>， 还是为业务提供界面展示功能的<code>Component</code>,  都分为App端和Web端两类， 并进行对应的实现。</p> <p>除了基础的API和组件， 我个人不太建议在App端开发大量业务相关的Module和Component, 这不仅会让业务的跨平台能力变弱，同样也会让业务依赖于客户端的发版， 不够灵活。</p> <p>相反， 我们可以在Web端扩展和建设Weex业务通用的组件库， 一方面可以大大提升业务开发的效率， 同时也统一了UI风格和标准。</p> <h2 id="ii-工程化建设"><a href="#ii-工程化建设" aria-hidden="true" class="header-anchor">#</a> II. 工程化建设</h2> <p>前面也提到，Weex官方提供了工程脚手架<code>Weex-toolkit</code>和应用示例，但仍然远远无法满足我们在业务开发过程中的种种需求，同时也无法对接公司现有前端发布系统和解决方案。
关于<code>Weex-toolkit</code>构建脚本的源码分析：</p> <ul><li><a href="/tech/weex/wt-router.html">Weex-toolkit build with VueRouter</a></li> <li><a href="/tech/weex/wt-no-router.html">Weex-toolkit build without VueRouter</a></li></ul> <p>为了解决工程构建相关问题，提高业务开发效率，我们需要根据公司前端开发流程和规范， 进行Weex工程化相关的建设工作。</p> <p>避免重复造轮子，我们利用公司的脚手架工具（开源版<a href="https://github.com/weidian-inc/bio-cli" target="_blank" rel="noopener noreferrer">BIO<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），开发了Weex工程的脚手架。</p> <p>在开发友好方面，脚手架为工程提供了统一的项目骨架， 不仅可以帮助开发同学零成本完成Weex工程环境的搭建，还提供了不同开发环境下的页面调试功能。</p> <p>在工程构建方面，脚手架在项目创建时一键初始化了整个工程的构建配置， 不仅降低了新手上手的难度，也大幅度减少了整个工程配置的成本。</p> <p>通过统一的工程构建配置和约定， 脚手架也完成了与公司Web发布平台的构建任务和发布流程的对接，支持业务代码在平台完成各环境下的云端构建和发布任务。</p> <p>由于脚手架本身肩负着与公司系统和流程衔接的职责， 代码中可能涉及一些比较敏感的内容不宜开源出来， 后续我针对工程构建过程中的一些问题和解决方案进行总结和补充。</p> <p>另外，伴随着公司全栈化建设的推进，使用weex来进行业务开发的同学可能来自不同的团队，相关知识基础以及对weex开发的理解和认知也各有不同。良好的文档有助于不同团队大幅度降低工作接入和沟通的成本。</p> <p>为此，们也为Weex打造了相对比较友好的文档系统，并对相关文档进行了整理，不仅介绍了如何快速上手业务开发，提供了详细的API使用文档和示例，同时也将我们日常所遇到的问题和相关解决方案逐步积累沉淀下来。</p> <p>这部分工作好比粘合剂或者胶水，将各部分工作都结合起来，并且与已有系统进行对接和适配。</p> <h2 id="iii-业务动态化"><a href="#iii-业务动态化" aria-hidden="true" class="header-anchor">#</a> III. 业务动态化</h2> <p>站在业务的角度来讲，强大的动态化能力可以让业务功能不依赖于APP发版，对于缩短业务迭代周期有着决定性意义。</p> <p>除了保证业务友好之外（灵活应对各类业务场景和需求），我们在技术层面还要考虑到以下问题：</p> <ul><li>页面的性能：如何降低页面（特别是关键路径上）的首屏时间</li> <li>业务稳定：当业务出现问题，如何进行降级（降级策略和粒度），保证业务可用性；</li> <li>业务安全：如何对客户端资源进行校验，防止资源文件被人为篡改和损坏；</li></ul> <p>这部分工作主要包括两部分内容：</p> <h3 id="_1-业务投放"><a href="#_1-业务投放" aria-hidden="true" class="header-anchor">#</a> 1.业务投放</h3> <p>通常情况下，前端Web页面发布完成后<code>Webview</code>通过加载URL访问页面资源即可。
Weex页面资源发布后，虽然也可以通过URL的方式直接访问和加载，但我们通常会有针对不同App，系统或App版本等维度的投放需。
除此之外，部分业务还需要有相应的主动降级策略，因此需要针对业务页面有相应的管理和投放策略， 相应的页面和数据都通过AppConfig投放给指定的终端。
初期的时候，我们专门开发了一个配置后台进行页面配置和框架流程上的试错， 随后我们将这部分工作集成到了公司前端的发布系统中， 与整个公司流程进行了打通。</p> <h3 id="_2-资源缓存"><a href="#_2-资源缓存" aria-hidden="true" class="header-anchor">#</a> 2.资源缓存</h3> <p>对于Weex业务的动态化而言，保证业务资源的及时更新和提高页面渲染的速度，不仅是业务页面触达用户的最后一公里路程，也是提高产品体验和页面性能最重要的一环。
为了提高页面打开和渲染速度，保证用户良好页面体验，需要在客户端设计并实现了<a href="/tech/weex/wx-client-cache.html">「Weex页面资源缓存策略与加载方案」</a>。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div> <div class="wrapper" data-v-5a084129><h5 data-v-5a084129></h5> <img src="/qrcode_self.jpg" data-v-5a084129></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.36f7a4d5.js" defer></script><script src="/assets/js/3.5e56f3a6.js" defer></script><script src="/assets/js/2.a56e4763.js" defer></script><script src="/assets/js/41.b05559b1.js" defer></script>
  </body>
</html>
