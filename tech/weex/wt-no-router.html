<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Weex-toolkit build without VueRouter | Giraffe&#39;s Blog</title>
    <meta name="description" content=" ">
    <link rel="icon short" href="/ico_avatar.ico" type="image/x-icon">
    
    <link rel="preload" href="/assets/css/0.styles.2fd78da2.css" as="style"><link rel="preload" href="/assets/js/app.36f7a4d5.js" as="script"><link rel="preload" href="/assets/js/3.5e56f3a6.js" as="script"><link rel="preload" href="/assets/js/2.a56e4763.js" as="script"><link rel="preload" href="/assets/js/42.32bc5efc.js" as="script"><link rel="prefetch" href="/assets/js/10.d856c855.js"><link rel="prefetch" href="/assets/js/11.171a332b.js"><link rel="prefetch" href="/assets/js/12.34e00da0.js"><link rel="prefetch" href="/assets/js/13.6a4bbdce.js"><link rel="prefetch" href="/assets/js/14.4eef22e3.js"><link rel="prefetch" href="/assets/js/15.80d8c8f1.js"><link rel="prefetch" href="/assets/js/16.408ca987.js"><link rel="prefetch" href="/assets/js/17.267749f1.js"><link rel="prefetch" href="/assets/js/18.be1ceda1.js"><link rel="prefetch" href="/assets/js/19.d6d6110b.js"><link rel="prefetch" href="/assets/js/20.c63fb21f.js"><link rel="prefetch" href="/assets/js/21.a8cdd90b.js"><link rel="prefetch" href="/assets/js/22.e6989c2d.js"><link rel="prefetch" href="/assets/js/23.6efb0d64.js"><link rel="prefetch" href="/assets/js/24.225dff0d.js"><link rel="prefetch" href="/assets/js/25.d6301564.js"><link rel="prefetch" href="/assets/js/26.48130fde.js"><link rel="prefetch" href="/assets/js/27.b4f579f9.js"><link rel="prefetch" href="/assets/js/28.d4af6c44.js"><link rel="prefetch" href="/assets/js/29.4dbe3fbe.js"><link rel="prefetch" href="/assets/js/30.d9c89cfb.js"><link rel="prefetch" href="/assets/js/31.314c8ce0.js"><link rel="prefetch" href="/assets/js/32.9ec8b6ed.js"><link rel="prefetch" href="/assets/js/33.668a40d2.js"><link rel="prefetch" href="/assets/js/34.746f8d03.js"><link rel="prefetch" href="/assets/js/35.84de9a82.js"><link rel="prefetch" href="/assets/js/36.a243395d.js"><link rel="prefetch" href="/assets/js/37.a9ff6e8c.js"><link rel="prefetch" href="/assets/js/38.1c3e1cdf.js"><link rel="prefetch" href="/assets/js/39.718c02a7.js"><link rel="prefetch" href="/assets/js/4.21f7bc64.js"><link rel="prefetch" href="/assets/js/40.640dda28.js"><link rel="prefetch" href="/assets/js/41.b05559b1.js"><link rel="prefetch" href="/assets/js/43.d6325d70.js"><link rel="prefetch" href="/assets/js/44.4897fa11.js"><link rel="prefetch" href="/assets/js/45.cc5207d2.js"><link rel="prefetch" href="/assets/js/46.ccff6404.js"><link rel="prefetch" href="/assets/js/5.e8e54c08.js"><link rel="prefetch" href="/assets/js/6.567c728a.js"><link rel="prefetch" href="/assets/js/7.efc9b48d.js"><link rel="prefetch" href="/assets/js/8.2d41cbc0.js"><link rel="prefetch" href="/assets/js/9.d52aa902.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fd78da2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Giraffe's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/reading/" class="nav-link">阅读随笔</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">技术思考</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/reading/" class="nav-link">阅读随笔</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">技术思考</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="weex-toolkit-build-without-vuerouter"><a href="#weex-toolkit-build-without-vuerouter" aria-hidden="true" class="header-anchor">#</a> Weex-toolkit build without VueRouter</h1> <p>Without VueRouter, the compile configurations for web and weex become much more complex. The common configuration for different environments is in the <code>webpack.common.conf.js</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getEntryFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  dir <span class="token operator">=</span> dir <span class="token operator">||</span> config<span class="token punctuation">.</span>sourceDir<span class="token punctuation">;</span><span class="token comment">//src</span>
  <span class="token comment">// The config.entryFilter is `**/*.vue`</span>
  <span class="token keyword">const</span> enrtys <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>entryFilter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>entryFilterOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// generate entry file </span>
  enrtys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// entry is relative path of vue file</span>
    <span class="token keyword">const</span> extname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> basename <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>extname<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// generate temp file to .temp dir</span>
    <span class="token keyword">const</span> templatePathForWeb <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>vueWebTemp<span class="token punctuation">,</span> basename <span class="token operator">+</span> <span class="token string">'.web.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> templatePathForNative <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>vueWebTemp<span class="token punctuation">,</span> basename <span class="token operator">+</span> <span class="token string">'.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// generate vueFile.web.js for every Vue File</span>
    fs<span class="token punctuation">.</span><span class="token function">outputFileSync</span><span class="token punctuation">(</span>templatePathForWeb<span class="token punctuation">,</span> <span class="token function">getWebEntryFileContent</span><span class="token punctuation">(</span>templatePathForWeb<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">outputFileSync</span><span class="token punctuation">(</span>templatePathForNative<span class="token punctuation">,</span> <span class="token function">getNativeEntryFileContent</span><span class="token punctuation">(</span>templatePathForNative<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    webEntry<span class="token punctuation">[</span>basename<span class="token punctuation">]</span> <span class="token operator">=</span> templatePathForWeb<span class="token punctuation">;</span>
    weexEntry<span class="token punctuation">[</span>basename<span class="token punctuation">]</span> <span class="token operator">=</span> templatePathForNative<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>getEntryFile</code> finds out all the vue files in <code>src</code> directory and generates js file for every vue file.</p> <p>As a result, the function collects the paths of entry file and creates 2 entry arrays for Web and Weex respectively.</p> <p>Based on entry.js, <code>getWebEntryFileContent</code> function generates entry file for every File:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//entryPath: .temp/vueFile.web.js</span>
<span class="token comment">// vueFilePath: src/vueFile.vue</span>
<span class="token keyword">const</span> <span class="token function-variable function">getWebEntryFileContent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">entryPath<span class="token punctuation">,</span> vueFilePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">// relative path of Vue File</span>
  <span class="token keyword">let</span> relativeVuePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>entryPath<span class="token punctuation">,</span> <span class="token string">'../'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vueFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//  abs path of entry.js</span>
  <span class="token keyword">let</span> relativeEntryPath <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">root</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>entryFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//  abs path of plugin.js   </span>
  <span class="token keyword">let</span> relativePluginPath <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">rootNode</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>pluginFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> contents <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token comment">// read the entry.js</span>
  <span class="token keyword">let</span> entryContents <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>relativeEntryPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isWin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    relativeVuePath <span class="token operator">=</span> relativeVuePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\/g</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    relativePluginPath <span class="token operator">=</span> relativePluginPath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\/g</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// add plugin info to entry file</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasPluginInstalled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    contents <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n// If detact plugins/plugin.js is exist, import and the plugin.js\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    contents <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import plugins from '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relativePluginPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">';\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    contents <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">plugins.forEach(function (plugin) {\n\tweex.install(plugin)\n});\n\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    entryContents <span class="token operator">=</span> entryContents<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/weex\.init/</span><span class="token punctuation">,</span> <span class="token parameter">match</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contents<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    contents <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
  contents <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
const App = require('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relativeVuePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">');
new Vue(Vue.util.extend({el: '#root'}, App));
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// entry File content concats content</span>
  <span class="token keyword">return</span> entryContents <span class="token operator">+</span> contents<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>getNativeEntryFileContent</code> function generates entry file for every Vue File:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//entryPath: .temp/vueFile.js</span>
<span class="token comment">// vueFilePath: src/vueFile.vue</span>
<span class="token keyword">const</span> <span class="token function-variable function">getNativeEntryFileContent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">entryPath<span class="token punctuation">,</span> vueFilePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> relativeVuePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>entryPath<span class="token punctuation">,</span> <span class="token string">'../'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vueFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> contents <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isWin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    relativeVuePath <span class="token operator">=</span> relativeVuePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\/g</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  contents <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import App from '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relativeVuePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'
App.el = '#root'
new Vue(App)
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> contents<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Respectively, the paths of entry file for weex and web are collected into two arrays: webEntry[basename] and weexEntry[basename].</p> <p>According to the entry files, the compiled outputs for every Vue File is placed in ./dist .</p> <h2 id="release-config"><a href="#release-config" aria-hidden="true" class="header-anchor">#</a> Release Config</h2> <p>The <code>webpack.prod.conf.js</code> file only adds a &quot;uglify&quot; plugin for weex building in production env.</p> <p>The different things are the web release configurations in <code>webpack.release.conf.js</code> file.</p> <p>By <code>HtmlWebpackPlugin</code>, webpack generates corresponding HTML File and and Javascript File for every Vue File.</p> <p><img src="/weex/weex-no-router.jpg" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div> <div class="wrapper" data-v-5a084129><h5 data-v-5a084129></h5> <img src="/qrcode_self.jpg" data-v-5a084129></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.36f7a4d5.js" defer></script><script src="/assets/js/3.5e56f3a6.js" defer></script><script src="/assets/js/2.a56e4763.js" defer></script><script src="/assets/js/42.32bc5efc.js" defer></script>
  </body>
</html>
